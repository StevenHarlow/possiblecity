{% extends "base.html" %}

{% load i18n %}
{% load staticfiles %}
{% load phileo_tags %}
{% load thumbnail %}

{% load possiblecity_tags %}

{% block head_title %}{% trans "Welcome" %}{% endblock %}

{% block body_class %}home{% endblock %}

{% block body %}
<div class="container">
    <div class="row">
        <div class="col-lg-12 col-12">
            {% get_latest_featured ideas.Idea 3 as featured_ideas %}
            <div id="featured-idea-slideshow" class="carousel slide">
              <!-- Indicators -->
              <ol class="carousel-indicators">
                {% for idea in featured_ideas %}
                <li data-target="#featured_idea_slideshow" data-slide-to="{{ forloop.counter }}"></li>
                {% endfor %}
              </ol>

              <!-- Wrapper for slides -->
              <div class="carousel-inner">
                {% for idea in featured_ideas %}
                <div class="item {% if forloop.first %}active{% endif %}">
                 <a href="{% if idea.lots.all %}
                           {% with idea.lots.all|first as lot %}
                            {% url 'lotxlot_lot_detail' lot.id %}#idea-{{ idea.id }}
                           {% endwith %}
                          {% else %}
                            {{ idea.get_absolute_url }}
                          {% endif %}">
                  <img src="{% thumbnail idea.get_lead_image.file '1170x490' crop upscale quality=100  %}" alt="{{ idea.title }}">
                 </a>
                  <div class="carousel-caption">
                    <h3>{{ idea.title }}</h3>
                    {% if idea.lots.all %}
                    <h4>
                    {% for lot in idea.lots.all %}
                    <i class="icon-map-marker"> {{ lot.address }}</i>{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                    </h4>
                    {% endif %}
                    <p>{{ idea.tagline }}</p>
                  </div>
                </div>
                {% endfor %}
              </div>

              <!-- Controls -->
              <a class="left carousel-control" href="#featured-idea-slideshow" data-slide="prev">
                <span class="icon-prev"></span>
              </a>
              <a class="right carousel-control" href="#featured-idea-slideshow" data-slide="next">
                <span class="icon-next"></span>
              </a>
            </div>


            <div class="homepage-intro jumbotron">
                <h1>Possible City</h1>
                <h2>Reimagining Philadelphia's vacant lots</h2>
            </div>

        </div>
    </div>
    <div class="panel latest-ideas">
        <div class="row ">
            <div class="col-lg-12 col-12">
                <h2>Latest Ideas</h2>
                {% get_latest ideas.Idea 6 as latest_ideas %}
                {% for idea in latest_ideas %}
                {% if forloop.first or forloop.counter|divisibleby:"4" %}
                <div class="row margin-bottom-20">
                {% endif %} 
                    <div class="col-lg-4">
                        <div class="row">
                            <div class="col-lg-4">
                                <a class="pull-left profile-img" href="{% url 'profiles_profile_detail' idea.user.username %}">
                                    <img class="media-object"  
                                        alt="{{ idea.user }}" 
                                        {% if idea.user.profile.photo %}
                                        src="{% thumbnail idea.user.profile.photo '400x400' crop %}" 
                                        {% else %}
                                        src="{% static 'img/profile.png' %}"
                                        {% endif %} 
                                    />
                                </a>
                            </div>
                            <div class="col-lg-8">
                                <h4 class="media-heading">
                                    {% if idea.user.first_name %}
                                        {{ idea.user.profile.full_name }}
                                    {% else %}
                                        {{ idea.user.username }}
                                    {% endif %}
                                    <small>on</small>
                                    {% for lot in idea.lots.all %}
                                    <a href="{% url 'lotxlot_lot_detail' lot.id %}">
                                        {{ lot.address }}</a>{% if not forloop.last %}, {% endif %} 
                                        {% endfor %}
                                </h4>
                                <p>{{ idea.tagline }}</p>
                                <h6>Via {{ idea.get_via_display }}
                                    {% if idea.get_via_display == "Twitter" %}
                                    <i class="icon-twitter"></i>
                                    {% elif idea.get_via_display == "Text" %}
                                    <i class="icon-mobile-phone"></i>
                                    {% elif idea.get_via_display == "Web" %}
                                    <i class="icon-globe"></i>
                                    {% elif idea.get_via_display == "Instagram" %}
                                    <i class="icon-instagram"></i>
                                    {% endif %}
                                    &nbsp;•&nbsp; {{ idea.floated|ago }}
                                    {% if request.user.is_authenticated %}
                                    &nbsp;•&nbsp; {% phileo_widget request.user idea %}
                                    {% else %}
                                    <span class="phileo">
                                        &nbsp;•&nbsp;
                                        <a data-toggle="modal" data-target="#login-modal" href="#login-modal">
                                             Like
                                        </a>
                                        &nbsp;•&nbsp;
                                        <i class="{% if idea|likes_count > 0 %}icon-heart{% else %}icon-heart-empty{% endif %}"></i>
                                        <span class="count">
                                            {{ idea|likes_count }}
                                        </span>
                                    </span>
                                    {% endif %}
                                </h6> 
                            </div>
                        </div>
                    </div>
                {% if forloop.counter|divisibleby:"3" %}
                </div>
                {% endif %} 
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock body %}
