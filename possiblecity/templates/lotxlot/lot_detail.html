{% extends "lotxlot/map_base.html" %}
{% load staticfiles %}
{% load humanize %}
{% block head_title %}Lot {{ lot.address }} {% endblock head_title %}
{% block body %}
    <div class="sidebar ideas-lot-info-sidebar">
        <div class="close-button pull-right">
            <button type="button" class="close ">&times<button>
         </div>
        <header class="lot-id-header">
            <h1>Lot {{ lot.id }}</h1>
            <h2>{{ lot.address }}</h2>
        </header>
        <ul id="sidebar-tabs" class="nav nav-tabs">
          <li class="active"><a href="#ideas" data-toggle="tab">Ideas</a></li>
          <li class=""><a href="#info" data-toggle="tab">Info</a></li>
        </ul>
    </div>
{% endblock body %}
{% block map_js %}
<script>
    var lot = L.geoJson(null, {
        style: selectedLotStyle
    }).addTo(map);

    var vacant = L.geoJson(null, {
        style: lotStyle
    }).addTo(map);
    

    $.getJSON('{% url "api_lot_detail" lot.id %}', function(data){
          lot.addData(data);
          var center = new L.LatLng({{ lot.coord.y }}, {{ lot.coord.x }});
          map.setView(center, 18);
          L.marker(center).addTo(map);
    });

    function onEachFeature(feature, layer) {
    // does this feature have a property named address?
      if (feature.properties) {
          html = '<h4>' + feature.properties.address +'</h4>' +
                 '<p><a class="btn btn-primary" href="' + Urls.lotxlot_lot_detail(feature.properties.id) + '">View</a>'
          layer.bindPopup(html);
      }
    }

    $.getJSON('{% url "api_lots_vacant" %}', function(data){
          vacant  = L.geoJson(data, {
            style: lotStyle,
            onEachFeature: onEachFeature
        }).addTo(map);
    });

</script>
{% endblock map_js %}
