{% extends "lotxlot/base.html" %}
{% load staticfiles %}
{% load humanize %}
{% block head_title %}Lotxlot{% endblock head_title %}
{% block extra_style %}
<style>
   body {
       padding-top: 50px;
   }
   #map {
      position: absolute;
      width: 100%;
      height: 100%;
   }
</style>
{% endblock extra_style %}
{% block body_base %}
    <div id="map"></div>
{% endblock body_base %}
{% block extra_body %}
<script>
    // Initialize the map object
    var map = new L.Map('map', {
        zoomControl: true,
        doubleClickZoom: true,
        maxZoom: 21,
        minZoom: 16
    });
    
    // Prep the background tile layer
    var tileUrl = 'http://api.tiles.mapbox.com/v3/dmeehan.map-sued82zn/{z}/{x}/{y}.png';
    var tileAttribution = '';

    var streets = L.tileLayer(tileUrl, {
        attribution: tileAttribution,
    });
    
    
    // Set the center on Philadelphia
    var philadelphia = new L.LatLng(39.9522, -75.1642);
    map.setView(philadelphia, 15);
    
    map.addLayer(streets);
    
    var lotStyle = {
        "fillColor":"#e8db00",
        "fillOpacity": 0.0,
        "opacity": 1.0,
        "weight": 2,
        "color":"#e8db00",
        "dashArray": "1 3"
    };
 
        var selectedLotStyle = {
        "fillColor":"#e8db00",
        "fillOpacity": 0.0,
        "opacity": 1.0,
        "weight": 4,
        "color":"#e8db00",
    };

    
   
    var lot = L.geoJson(null, {
        style: selectedLotStyle
    }).addTo(map);

    var vacant = L.geoJson(null, {
        style: lotStyle
    }).addTo(map);
    
    $.getJSON('{% url "api_lot_detail" lot.id %}', function(data){
          lot.addData(data);
          var center = new L.LatLng({{ lot.coord.y }}, {{ lot.coord.x }});
          map.setView(center, 18);
          L.marker(center).addTo(map);
    });

    $.getJSON('{% url "api_lots_vacant" %}', function(data){
          vacant.addData(data);
    });
</script>
{% endblock extra_body %}
