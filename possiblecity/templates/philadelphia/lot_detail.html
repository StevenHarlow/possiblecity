{% extends "philadelphia/base.html" %}
{% load possiblecity_tags %}
{% load staticfiles %}
{% block layout %}
<div class="page-content">
    <div id="map" style="height:29em; width: 100%">
    </div>
    <div id="map-status" class="status" style="display:none">
        Loading Map Features...
    </div>
    <article class="lot">
        <section class="details">
            <h1>{{ lot.address|capsentence }}</h1>
            <p>{{ lot.parcel.shape_area }}</p>
            {% if lot.is_vacant %}<p>Vacant</p>{% endif %}
            {% if lot.has_vacancy_license %}<p>Vacancy License</p>{% endif %}
            {% if lot.has_vacancy_violation %}<p>Vacancy Violation</p>{% endif %}
            {% if lot.is_public %}<p>Public</p>{% endif %}
        </section>
        <section class="people">
            <p>This is more stuff</p>
            <p>even more stuff</p>
            <p>This is more stuff</p>
            <p>even more stuff</p>
            <p>This is more stuff</p>
            <p>even more stuff</p>
            <p>This is more stuff</p>
            <p>even more stuff</p>
            <p>This is more stuff</p>
            <p>even more stuff</p>
            <p>This is more stuff</p>
            <p>even more stuff</p>
        </section>
    </article>
</div>
{% endblock layout %}
{% block js_local %}
<script src="http://maps.google.com/maps/api/js?v=3.2&sensor=false"></script>
<script src="{% static 'js/libs/leaflet-plugins/layer/tile/Google.js' %}"></script>
<script>
    // Initialize the map object
    var map = new L.Map('map', {
        zoomControl: false
    });
    
    // Prep the background tile layer
    var tileUrl = 'http://api.tiles.mapbox.com/v3/dmeehan.map-sued82zn/{z}/{x}/{y}.png';
    var tileAttribution = '';
    
    var streets = L.tileLayer(tileUrl, {
        attribution: tileAttribution,
        maxZoom: 20,
        minZoom: 11,
    });
    
    
    // Set the center on Philadelphia
    var philadelphia = new L.LatLng(39.9522, -75.1642);
    map.setView(philadelphia, 16);
    
    var satellite = new L.Google();
    
    map.addLayer(streets);

    var geoj = {};
    
    var polyStyle = {
        "fillColor":"#e8db00",
        "fillOpacity": 0.2,
        "opacity": 1.0,
        "weight": 4,
        "color":"#e8db00",
        //"dashArray": "4 2"
    };
    
    var myStyle = {
        "fillColor": "#ff0000",
        "opacity": 1.0,
        "weight": 1,
        "color":"#000000",
        "dashArray": "2 2"
    };

    var myLayer = L.geoJson(null, {
        style: polyStyle
    }).addTo(map);
    
    $.getJSON('{% url lot_detail lot.id %}', function(data){
          myLayer.addData(data);
          map.fitBounds(myLayer.getBounds());
          map.panBy([-500, -100]);
          zoom = map.getZoom();
          newZoom = zoom-1;
          map.setZoom(newZoom);
    });

</script>
{% endblock js_local %}
