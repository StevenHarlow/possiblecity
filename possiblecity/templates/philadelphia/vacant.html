{% extends "philadelphia/base.html" %}
{% block layout %}
<div class="page-content" style="position:relative; top:100px">
	<div id="map" style="height:600px; width: 100%">
    </div>
    <div id="map-status" class="status" style="display:none">
        Loading Map Features...
    </div>
</div>
{% endblock layout %}
{% block js_local %}
<script src="{{ STATIC_URL }}js/libs/lvector/lvector.js"></script>
<script src="{{ STATIC_URL }}js/libs/lvector/Custom.js"></script>
<script src="{{ STATIC_URL }}js/libs/leaflet-plugins/layer/tile/Bing.js"></script>
<script>
    // Initialize the map object
    var map = L.map('map');
    
    // Prep the background tile layer
    var tileUrl = 'http://api.tiles.mapbox.com/v3/dmeehan.map-sued82zn/{z}/{x}/{y}.png';
    var tileAttribution = '';
    
    L.tileLayer(tileUrl, {
       attribution: tileAttribution,
    }).addTo(map);


    // Locate and set center
    // XMin: -8380165.3987
    // YMin: 4846635.811
    // XMax: -8344035.7458 
    // YMax: 4886006.8845
    var philadelphia = new L.LatLng(39.9522, -75.1642);
    var southWest = new L.LatLng(39.87, -75.28);
    var northEast = new L.LatLng(40.14, -74.96);
    var phlBounds = new L.LatLngBounds(southWest, northEast);

    map.locate();
    //var denver = new L.LatLng(39.74154151936245, -104.99968229904174);

    map.setView(philadelphia, 16);
    
    var lotLayer = new lvector.Custom({
            url: "{% url 'api_lots_vacant' %}",
            scaleRange: [14, 21],
            showAll: false,
            popupTemplate: "<h3>Lot</h3>",
            symbology: {
                type: "single",
                vectorOptions: {
                    fillColor: "#2f4a00",
                    fillOpacity: 0.4,
                    strokeWeight: 1.8,
                    strokeColor: "#2f4a00",
                    strokeOpacity: 1
                }
            }              
    });
    
    function onLocationFound(e) {
        if (phlBounds.contains(e.latlng)) {
           center = e.latlng
        } else {
           center = philadelphia
        }
        map.setView(center, 16);
        L.marker(center).addTo(map);
        bounds = map.getBounds().toBBoxString();
        alert(bounds);
        lotLayer.setMap(map);
    }

    map.on('locationfound', onLocationFound);

    function onLocationError(e) {
        alert(e.message);
    }

    map.on('locationerror', onLocationError); 

    var lotStyle = {
        "fillColor":"#e8db00",
        "fillOpacity": 0.2,
        "opacity": 1.0,
        "weight": 2,
        "color":"#e8db00",
    };

    

</script>
{% endblock js_local %}
